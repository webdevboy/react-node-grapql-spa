import Promise from 'bluebird';
import path from 'path';
import slugify from '../../core/generateSlug';
import {
  Language,
  User,
  MediaLibrary,
  Post,
  Term,
  TermTaxonomy,
} from '../models';

const filename = path.basename(__filename);
const DESCRIPTION = `Auto generated by seed name: ${filename}`;

export default {
  up: async () => {

    const author = await User.findOne();
    const en = await Language.findOne({ where: { locale: 'en', enabled: true } });
    const fr = await Language.findOne({ where: { locale: 'fr', enabled: true } });
    const contentEN = JSON.parse ("{\"entityMap\":{},\"blocks\":[{\"key\":\"8donc\",\"text\":\"HELLO it is me\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[{\"offset\":0,\"length\":14,\"style\":\"BOLD\"},{\"offset\":0,\"length\":14,\"style\":\"ITALIC\"}],\"entityRanges\":[],\"data\":{}},{\"key\":\"3qoma\",\"text\":\"How are you?\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[{\"offset\":0,\"length\":12,\"style\":\"BOLD\"},{\"offset\":0,\"length\":12,\"style\":\"ITALIC\"}],\"entityRanges\":[],\"data\":{}},{\"key\":\"agvao\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}}]}");
    const contentFR = JSON.parse ("{\"entityMap\":{},\"blocks\":[{\"key\":\"8donc\",\"text\":\"BONJOUR monsieur\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[{\"offset\":0,\"length\":14,\"style\":\"BOLD\"},{\"offset\":0,\"length\":14,\"style\":\"ITALIC\"}],\"entityRanges\":[],\"data\":{}},{\"key\":\"3qoma\",\"text\":\"Comment ca va?\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[{\"offset\":0,\"length\":12,\"style\":\"BOLD\"},{\"offset\":0,\"length\":12,\"style\":\"ITALIC\"}],\"entityRanges\":[],\"data\":{}},{\"key\":\"agvao\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}}]}");

    const term_en = await Term.findOne ({
      where: {
        language_id: en.id,
        slug: 'csr-en'
      }
    });

    const term_fr = await Term.findOne ({
      where: {
        language_id: fr.id,
        slug: 'csr-fr'
      }
    });

    const term_taxonomies_en = await TermTaxonomy.findOne ({
      where: {
        term_id: term_en.id,
        taxonomy: 'article_category'
      }
    });

    const term_taxonomies_fr = await TermTaxonomy.findOne ({
      where: {
        term_id: term_fr.id,
        taxonomy: 'article_category'
      }
    })

    const images = await MediaLibrary.findAll({ limit: 3 });

    const first = await Post.create({
      post_id: 'csr1',
      title: 'Something we all should be aware of',
      summary: 'The automaker said it had addressed bottlenecks in the output of its first mass-market offering in the first quarter and was now making 2,000 a week.',
      body: {
        main: contentEN,
      },
      meta: {
        source: "http://unicef.com",
        featured: false,
      },
      state: 'published',
      type: 'article',
      language_id: en.id,
      user_id: author.id,
      media_id: images[1].id,
    });
    await first.addTaxonomies(term_taxonomies_en);

    // FRENCH
    const second = await Post.create({
      post_id: 'csr1',
      title: 'Something we all should be aware of',
      summary: 'The automaker said it had addressed bottlenecks in the output of its first mass-market offering in the first quarter and was now making 2,000 a week.',
      body: {
        main: contentFR,
      },
      meta: {
        source: "http://unicef.com",
        featured: false,
      },
      state: 'published',
      type: 'article',
      language_id: fr.id,
      user_id: author.id,
      media_id: images[2].id,
    });
    await second.addTaxonomies(term_taxonomies_fr);


  },
  down: async () => {
    await Post.destroy({ where: { type: 'article', post_id: 'csr1' }, cascade: true, force: true });
  },
};